<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="540" viewBox="0 0 1200 540">
  <defs>
    <style>
      .title { font: 700 20px Arial, "Noto Sans SC", sans-serif; fill: #111; }
      .sub   { font: 700 14px Arial, "Noto Sans SC", sans-serif; fill: #111; }
      .text  { font: 13px Arial, "Noto Sans SC", sans-serif; fill: #111; }
      .hint  { font: 12px Arial, "Noto Sans SC", sans-serif; fill: #555; }
      .box   { fill: #fff; stroke: #111; stroke-width: 1.5; rx: 12; ry: 12; }  
      .box { fill：#fff; stroke：#111; stroke-width: 1.5; rx：12; ry: 12; }
      .box2  { fill: #fafafa; stroke: #111; stroke-width: 1.5; rx: 12; ry: 12; }  
      .box2 { fill：#fafafa; stroke：#111; stroke-width: 1.5; rx：12; ry: 12; }
      .dash  { fill: #fff; stroke: #111; stroke-width: 1.5; stroke-dasharray: 6 5; rx: 12; ry: 12; }
      .arrow { stroke: #111; stroke-width: 2; fill: none; }
    </style>
    <marker id="arrowHead" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <path d="M0,0 L12,6 L0,12 Z" fill="#111" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="40" y="40" class="title">树状流程：require_detailed → 选择“直接推理”或“逐图抽取→证据→汇总推理”</text>

  <!-- Root -->
  <rect x="390" y="70" width="420" height="78" class="box"/>
  <text x="410" y="100" class="sub">输入</text>
  <text x="410" y="124" class="text">User Prompt + img1..imgN（数量不定）</text>

  <!-- Decision -->
  <polygon points="600,170 670,220 600,270 530,220" fill="#fff" stroke="#111" stroke-width="1.5"/>                  
  <text x="545" y="220" class="sub">require_detailed</text>            

  <!-- Branch labels -->
 
  <text x="325" y="246" class="hint">false：普通模式</text>          
  <text x="760" y="246" class="hint">true：逐图分析模式</text>      

  <!-- Left branch -->
  <rect x="140" y="290" width="360" height="86" class="box2"/>
  <text x="160" y="322" class="sub">多图直接推理</text>  
  <text x="160" y="346" class="text">[User Prompt] + [img1..imgN]</text>
  <text x="160" y="368" class="hint">注意力稀释 / distractor 混淆 / 引用不清</text>  

  <rect x="140" y="404" width="360" height="86" class="box"/>
  <text x="160" y="436" class="sub">输出（普通）</text>
  <text x="160" y="460" class="text">回答 / 决策</text>
  <text x="160" y="482" class="hint">（更便宜更快，但多图更易不稳）</text>

  <!-- Right branch: extraction -->
  <rect x="700" y="290" width="360" height="96" class="box2"/>
  <text x="720" y="322" class="sub">逐图视觉抽取（并发 × N）</text>
  <text x="720" y="346" class="text">System Prompt（固定）+ 抽取指令（固定）</text>
  <text x="720" y="368" class="hint">每张图 → JSON summary</text>

  <!-- Right branch: middle layer -->
  <rect x="700" y="404" width="360" height="86" class="dash"/>
  <text x="720" y="436" class="sub">中间层（可选 / 可扩展）</text>
  <text x="720" y="458" class="text">关联 / 耦合 / 分离 / 去重 / 筛选 / 排序 …</text>
  <text x="720" y="480" class="hint">并在此完成：拼接证据 {"p1":…,"p2":…}</text>

  <!-- Right leaf: reasoning + output -->
  <rect x="700" y="504" width="360" height="0" fill="none"/>
  <rect x="700" y="504" width="360" height="0" fill="none"/>

  <rect x="700" y="504" width="360" height="0" fill="none"/>

  <rect x="700" y="504" width="360" height="0" fill="none"/>  

  <rect x="700" y="504" width="360" height="0" fill="none"/>    

  <rect x="700" y="504" width="360" height="0" fill="none"/>

  <rect x="700" y="504" width="360" height="0" fill="none"/>

  <rect x="700" y="504" width="360" height="0" fill="none"/>

  <rect x="700" y="504" width="360" height="0" fill="none"/>

  <!-- Actual leaf box placed at y=504 would overflow; so place at y=500 with height 40 -->
  <rect x="700" y="500" width="360" height="36" class="box"/>
  <text x="720" y="524" class="sub">LLM 汇总推理 → 输出（详细）</text>

  <!-- Root -> decision -->
  <path d="M600,148 L600,170" class="arrow" marker-end="url(#arrowHead)"/>

  <!-- Decision -> left (No) -->
  <path d="M530,220 L500,220 L320,220 L320,290" class="arrow" marker-end="url(#arrowHead)"/>
  <text x="505" y="212" class="hint">否</text>

  <!-- Left chain -->
  <path d="M320,376 L320,404" class="arrow" marker-end="url(#arrowHead)"/>

  <!-- Decision -> right (Yes) -->
  <path d="M670,220 L700,220 L880,220 L880,290" class="arrow" marker-end="url(#arrowHead)"/>
  <text x="676" y="212" class="hint">是</text>

  <!-- Right chain -->
  <path d="M880,386 L880,404" class="arrow" marker-end="url(#arrowHead)"/>
  <path d="M880,490 L880,500" class="arrow" marker-end="url(#arrowHead)"/>

</svg>
